<app-header></app-header>
<app-notifications></app-notifications>

<main
  class="px-6 mt-6 w-full h-screen overflow-auto"
  style="height: calc(100vh - 136px)"
>
  <div
    class="admin-dashboard p-8 sm:p-10 bg-gray-50 dark:bg-gray-900 min-h-screen rounded-lg shadow-lg transition-colors"
  >
    <!-- Título principal -->
    <h1
      class="text-3xl sm:text-4xl lg:text-5xl font-extrabold mb-8 sm:mb-10 text-kingfisher-daisy-600 dark:text-white"
    >
      Configuración de Ayudas
    </h1>

    <!-- Navegación entre secciones -->
    <nav class="mb-8 overflow-x-auto whitespace-nowrap flex w-full px-4">
      <a
        routerLink="/admin/"
        class="flex items-center px-4 py-2 sm:px-5 sm:py-3 bg-kingfisher-daisy-600 text-white text-sm sm:text-lg font-semibold rounded-lg shadow hover:bg-kingfisher-daisy-500 transition duration-300 mr-4 last:mr-0"
      >
        <span class="material-icons mr-2">dashboard</span> Dashboard
      </a>
      <a
        routerLink="/admin/usuarios"
        class="flex items-center px-4 py-2 sm:px-5 sm:py-3 bg-kingfisher-daisy-600 text-white text-sm sm:text-lg font-semibold rounded-lg shadow hover:bg-kingfisher-daisy-500 transition duration-300 mr-4 last:mr-0"
      >
        <span class="material-icons mr-2">group</span> Gestionar Usuarios
      </a>
      <a
        routerLink="/admin/configuracion"
        class="flex items-center px-4 py-2 sm:px-5 sm:py-3 bg-kingfisher-daisy-600 text-white text-sm sm:text-lg font-semibold rounded-lg shadow hover:bg-kingfisher-daisy-500 transition duration-300 mr-4 last:mr-0"
      >
        <span class="material-icons mr-2">settings</span> Configuraciones
      </a>
      <a
        routerLink="/admin/help"
        class="flex items-center px-4 py-2 sm:px-5 sm:py-3 bg-kingfisher-daisy-600 text-white text-sm sm:text-lg font-semibold rounded-lg shadow hover:bg-kingfisher-daisy-500 transition duration-300"
      >
        <span class="material-icons mr-2">help</span> Ayuda
      </a>
    </nav>

    <!-- Artículos de Ayuda -->
    <h2 class="text-2xl font-bold mb-4">Artículos de Ayuda</h2>

    <div *ngIf="isLoading" class="text-center mb-4">
      <p>Cargando...</p>
    </div>

    <div *ngIf="!isLoading && articles.length === 0" class="text-center mb-4">
      <p>No hay artículos de ayuda disponibles.</p>
    </div>

    <!-- Formulario para agregar nuevo artículo -->
    <form
      (ngSubmit)="addArticle()"
      #articleForm="ngForm"
      class="mb-8 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg"
    >
      <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">
        Agregar Nuevo Artículo
      </h3>
      <div class="mb-4">
        <label class="block mb-1 text-gray-700 dark:text-gray-300"
          >Título:</label
        >
        <input
          type="text"
          [(ngModel)]="newArticle.title"
          name="title"
          required
          class="border rounded w-full p-2 bg-gray-100 dark:bg-gray-700 dark:border-gray-600 text-gray-800 dark:text-gray-200"
        />
      </div>
      <div class="mb-4">
        <label class="block mb-1 text-gray-700 dark:text-gray-300"
          >Resumen:</label
        >
        <textarea
          [(ngModel)]="newArticle.summary"
          name="summary"
          required
          class="border rounded w-full p-2 bg-gray-100 dark:bg-gray-700 dark:border-gray-600 text-gray-800 dark:text-gray-200"
        ></textarea>
      </div>
      <div class="mb-4">
        <label class="block mb-1 text-gray-700 dark:text-gray-300"
          >Contenido:</label
        >
        <textarea
          [(ngModel)]="newArticle.content"
          name="content"
          required
          class="border rounded w-full p-2 bg-gray-100 dark:bg-gray-700 dark:border-gray-600 text-gray-800 dark:text-gray-200"
        ></textarea>
      </div>
      <div class="mb-4">
        <label class="block mb-1 text-gray-700 dark:text-gray-300"
          >Imagen:</label
        >
        <input
          type="file"
          (change)="onImageSelected($event)"
          class="border rounded w-full p-2 bg-gray-100 dark:bg-gray-700 dark:border-gray-600 text-gray-800 dark:text-gray-200"
        />
      </div>
      <button
        type="submit"
        class="bg-kingfisher-daisy-600 text-white py-2 px-4 rounded hover:bg-kingfisher-daisy-700 dark:bg-kingfisher-daisy-500 dark:hover:bg-kingfisher-daisy-600"
      >
        Agregar Artículo
      </button>
    </form>

    <ul
      *ngIf="!isLoading && articles.length > 0"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
    >
      <li
        *ngFor="let article of articles"
        class="p-4 border rounded-lg shadow-md transition-transform transform hover:scale-105 bg-white dark:bg-gray-800"
      >
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
          {{ article.title }}
        </h3>
        <p class="mt-1 text-gray-600 dark:text-gray-400">
          {{ article.summary }}
        </p>
        <img
          *ngIf="article.image"
          [src]="article.image"
          alt="{{ article.title }}"
          class="mt-2 w-full h-auto rounded-md shadow"
        />
        <div class="mt-3">
          <a
            *ngIf="article.link"
            [href]="article.link"
            class="text-blue-600 hover:underline dark:text-blue-400"
            target="_blank"
            >Leer más</a
          >
        </div>
        <div class="mt-4 flex gap-1">
          <button
            (click)="openEditingArticle(article)"
            class="bg-yellow-500 hover:bg-yellow-400 text-white py-1 px-2 rounded transition-colors"
          >
            Editar
          </button>
          <button
            (click)="deleteArticle(article.id)"
            class="bg-red-600 hover:bg-red-500 text-white py-1 px-2 rounded transition-colors"
          >
            Eliminar
          </button>
        </div>
      </li>
    </ul>

    <!-- Preguntas Frecuentes -->
    <h2 class="text-2xl font-bold mt-8 mb-4">Preguntas Frecuentes</h2>
    <div *ngIf="!isLoading && faqs.length === 0" class="text-center mb-4">
      <p>No hay preguntas frecuentes disponibles.</p>
    </div>

    <!-- Formulario para agregar nueva pregunta -->
    <form
      (ngSubmit)="addFAQ()"
      #faqForm="ngForm"
      class="mb-8 p-6 bg-white dark:bg-gray-800 rounded-lg shadow-md"
    >
      <h3 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-white">
        Agregar Nueva Pregunta Frecuente
      </h3>
      <div class="mb-4">
        <label class="block mb-1 text-gray-700 dark:text-gray-300"
          >Pregunta:</label
        >
        <input
          type="text"
          [(ngModel)]="newFAQ.question"
          name="question"
          required
          class="border rounded w-full p-3 transition duration-200 focus:ring focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
          placeholder="Escribe la pregunta aquí..."
        />
      </div>
      <div class="mb-4">
        <label class="block mb-1 text-gray-700 dark:text-gray-300"
          >Respuesta:</label
        >
        <textarea
          [(ngModel)]="newFAQ.answer"
          name="answer"
          required
          rows="4"
          class="border rounded w-full p-3 transition duration-200 focus:ring focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
          placeholder="Escribe la respuesta aquí..."
        ></textarea>
      </div>
      <button
        type="submit"
        class="bg-blue-600 hover:bg-blue-500 text-white py-2 px-4 rounded transition duration-200"
      >
        Agregar Pregunta
      </button>
    </form>

    <ul *ngIf="!isLoading && faqs.length > 0" class="space-y-4">
      <li
        *ngFor="let faq of faqs"
        class="p-6 border rounded-lg shadow-md bg-white dark:bg-gray-800 transition duration-200"
      >
        <h3 class="text-xl font-semibold text-gray-800 dark:text-white">
          {{ faq.question }}
        </h3>
        <p class="mt-2 text-gray-600 dark:text-gray-300">{{ faq.answer }}</p>

        <div class="mt-4 flex space-x-2">
          <button
            (click)="openEditing(faq)"
            class="bg-yellow-500 hover:bg-yellow-400 text-white py-2 px-4 rounded transition duration-200"
          >
            Editar
          </button>
          <button
            (click)="deleteFAQ(faq.id)"
            class="bg-red-600 hover:bg-red-500 text-white py-2 px-4 rounded transition duration-200"
          >
            Eliminar
          </button>
        </div>
      </li>
    </ul>
  </div>
</main>

<!-- Articles -->
<div
  class="fixed z-10 inset-0 overflow-y-auto"
  *ngIf="isOpenEditingArticle"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-gray-600 dark:bg-black bg-opacity-75 transition-opacity"
      aria-hidden="true"
    ></div>

    <span
      class="hidden sm:inline-block sm:align-middle sm:h-screen"
      aria-hidden="true"
    >
      &#8203;
    </span>

    <div
      class="inline-block align-bottom bg-white dark:bg-gray-900 rounded-lg px-8 pt-7 pb-8 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-10"
    >
      <h3
        class="text-xl leading-6 font-medium text-gray-900 dark:text-gray-100 mb-6"
        id="modal-title"
      >
        Editar Artículo
      </h3>

      <form (ngSubmit)="editArticle(valuesArticle)">
        <div class="space-y-6">
          <!-- Campo para el título -->
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Título
            </label>
            <input
              type="text"
              [(ngModel)]="valuesArticle.title"
              name="title"
              class="py-2 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-gray-100"
              required
            />
          </div>

          <!-- Campo para el resumen -->
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Resumen
            </label>
            <textarea
              [(ngModel)]="valuesArticle.summary"
              name="summary"
              rows="2"
              class="py-2 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-gray-100"
              required
            ></textarea>
          </div>

          <!-- Campo para el contenido -->
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Contenido
            </label>
            <textarea
              [(ngModel)]="valuesArticle.content"
              name="content"
              rows="4"
              class="py-2 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-gray-100"
              required
            ></textarea>
          </div>

          <!-- Campo para la imagen -->
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Imagen
            </label>
            <input
              type="file"
              (change)="onImageSelected($event)"
              class="block w-full text-gray-500 dark:text-gray-300"
            />
            <div *ngIf="imagePreview" class="mt-2">
              <img
                [src]="imagePreview"
                alt="Previsualización"
                class="max-w-full h-auto rounded-md"
              />
            </div>
          </div>

          <!-- Botones de acción -->
          <div class="mt-6 sm:flex sm:flex-row-reverse">
            <button
              (click)="editArticle(valuesArticle)"
              type="submit"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-5 py-3 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Guardar
            </button>
            <button
              type="button"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-5 py-3 bg-gray-200 dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:mt-0 sm:w-auto sm:text-sm"
              (click)="CloseEditingArticle()"
            >
              Cancelar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- FQA -->
<div
  class="fixed z-10 inset-0 overflow-y-auto"
  *ngIf="isOpenEditingFQA"
  aria-labelledby="modal-title"
  role="dialog"
  aria-modal="true"
>
  <div
    class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
  >
    <div
      class="fixed inset-0 bg-gray-600 dark:bg-black bg-opacity-75 transition-opacity"
      aria-hidden="true"
    ></div>

    <span
      class="hidden sm:inline-block sm:align-middle sm:h-screen"
      aria-hidden="true"
    >
      &#8203;
    </span>

    <div
      class="inline-block align-bottom bg-white dark:bg-gray-900 rounded-lg px-8 pt-7 pb-8 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-10"
    >
      <h3
        class="text-xl leading-6 font-medium text-gray-900 dark:text-gray-100 mb-6"
        id="modal-title"
      >
        Editar Pregunta
      </h3>

      <form (ngSubmit)="editFAQ(valuesFQA)">
        <div class="space-y-6">
          <!-- Campo para la pregunta -->
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Pregunta
            </label>
            <input
              type="text"
              [(ngModel)]="newFAQ.question"
              name="question"
              class="py-2 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-gray-100"
              required
            />
          </div>

          <!-- Campo para la respuesta -->
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
              Respuesta
            </label>
            <textarea
              [(ngModel)]="newFAQ.answer"
              name="answer"
              rows="3"
              class="py-2 block w-full shadow-sm sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-gray-100"
              required
            ></textarea>
          </div>

          <!-- Botones de acción -->
          <div class="mt-6 sm:flex sm:flex-row-reverse">
            <button
              type="submit"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-5 py-3 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Guardar
            </button>
            <button
              type="button"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-5 py-3 bg-gray-200 dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:mt-0 sm:w-auto sm:text-sm"
              (click)="CloseEditing()"
            >
              Cancelar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
